<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Lagos Sector</title>
    <link rel="stylesheet" href="assets/styles/game.scss">
  </head>
  <body draggable="false">
  </body>

  <script>
    import Scene from './src/scene/scene';
    import AudioEmitter from './src/scene/audio-emitter';
    import PlayerShip from './src/ship/player-ship';
    import AIShip from './src/ship/ai-ship';
    import Score from './src/ui/score';
    import ShieldGauge from './src/ui/shield-gauge';

    import { DiceThrow } from 'xethya-dice';

    const scene = new Scene({
      background: 'stars'
    });

    // Registering all sounds
    const audioEmitter = new AudioEmitter();
    audioEmitter.registerSound({ name: 'background-music', src: 'through-space.ogg', volume: 0.4 });
    audioEmitter.registerSound({ name: 'energy-cannon', src: 'laser4.mp3' });
    audioEmitter.registerSound({ name: 'explosion--small', src: 'boom3.wav', volume: 0.2 });

    audioEmitter.emit('background-music');

    // Rendering the player's ship
    const ship = new PlayerShip({ name: 'The Lagos', shipClass: 'interceptor' });
    ship.renderTo(scene);

    // Score controller
    const score = new Score();

    // Shield gauge
    const shieldGauge = new ShieldGauge();

    // Spawing fighters
    let fighterCount = 0;

    const diceThrow = new DiceThrow(5, scene.__element__.getBoundingClientRect().width);

    const spawner = () => {
      if (fighterCount < 5) {
        const ship = new AIShip({
          name: `enemy${fighterCount + 1}`,
          shipClass: 'fighter'
        });
        ship.startingXPos = diceThrow.roll().rolls[fighterCount];
        ship.startingYPos = -diceThrow.roll().rolls[0];
        ship.renderTo(scene);
        fighterCount += 1;
        ship.on('aiShipGone', () => { fighterCount--; })
      }
      callSpawner();
    };

    const callSpawner = () => {
      window.requestAnimationFrame(spawner);
    }

    // callSpawner();
  </script>
</html>
