<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Lagos Sector</title>
    <link rel="stylesheet" href="assets/styles/game.scss">
  </head>
  <body draggable="false">
    <scene background="stars" />
  </body>

  <script>
    import PlayerShip from './src/ship/player-ship';
    import AIShip from './src/ship/ai-ship';
    import AudioEmitter from './src/scene/audio-emitter';
    import Score from './src/scene/score';

    import { DiceThrow } from 'xethya-dice';

    const scene = document.querySelector('scene');

    // Registering all sounds
    const audioEmitter = new AudioEmitter();
    audioEmitter.registerSound({ name: 'background-music', src: 'through-space.ogg', volume: 0.4 });
    audioEmitter.registerSound({ name: 'energy-cannon', src: 'laser4.mp3' });
    audioEmitter.registerSound({ name: 'explosion--small', src: 'boom3.wav', volume: 0.2 });

    audioEmitter.emit('background-music');

    // Score controller
    const score = new Score();

    // Rendering the player's ship
    const ship = new PlayerShip('The Lagos');
    ship.shipClass = "escort";
    ship.renderTo(scene);

    // Spawing fighters
    let fighterCount = 0;

    const diceThrow = new DiceThrow(5, scene.getBoundingClientRect().width);

    const spawner = () => {
      if (fighterCount < 5) {
        const ship = new AIShip('ENEMY_1', 'Fighter');
        ship.shipClass = "fighter";
        ship.startingXPos = diceThrow.roll().rolls[fighterCount];
        ship.startingYPos = -diceThrow.roll().rolls[0];
        ship.renderTo(scene);
        fighterCount += 1;
        ship.on('aiShipGone', () => { fighterCount--; })
      }
      callSpawner();
    };

    const callSpawner = () => {
      window.requestAnimationFrame(spawner);
    }

    callSpawner();
  </script>
</html>
